databaseChangeLog:
    - changeSet:
          id: 1771695148953-1
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: roles_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: role_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: role_name
                              type: VARCHAR(50)
                    tableName: roles
    - changeSet:
          id: 1771695148953-2
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: permissions_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: permission_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: permission_name
                              type: VARCHAR(100)
                    tableName: permissions
    - changeSet:
          id: 1771695148953-3
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: users_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: user_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: user_name
                              type: VARCHAR(255)
                        - column:
                              constraints:
                                  nullable: false
                              name: password_hash
                              type: VARCHAR(255)
                        - column:
                              constraints:
                                  nullable: false
                              name: role_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: created_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                    tableName: users
    - changeSet:
          id: 1771695148953-4
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: classes_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: class_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: class_name
                              type: VARCHAR(255)
                    tableName: classes
    - changeSet:
          id: 1771695148953-5
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: students_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: student_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: student_code
                              type: VARCHAR(50)
                        - column:
                              constraints:
                                  nullable: false
                              name: name
                              type: VARCHAR(255)
                        - column:
                              constraints:
                                  nullable: false
                              name: class_id
                              type: UUID
                        - column:
                              name: status
                              type: BOOLEAN
                    tableName: students
    - changeSet:
          id: 1771695148953-6
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: subjects_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: subject_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: subject_code
                              type: VARCHAR(50)
                        - column:
                              constraints:
                                  nullable: false
                              name: subject_name
                              type: VARCHAR(255)
                    tableName: subjects
    - changeSet:
          id: 1771695148953-7
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: semesters_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: semester_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: semester_name
                              type: VARCHAR(255)
                    tableName: semesters
    - changeSet:
          id: 1771695148953-8
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: scores_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: score_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: student_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: subject_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: semester_id
                              type: UUID
                        - column:
                              name: score
                              type: numeric(5, 2)
                        - column:
                              constraints:
                                  nullable: false
                              defaultValueNumeric: 1
                              name: version
                              type: INTEGER
                        - column:
                              name: user_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: create_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                        - column:
                              constraints:
                                  nullable: false
                              name: upload_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                    tableName: scores
    - changeSet:
          id: 1771695148953-9
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: upload_batches_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: upload_batch_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: file_name
                              type: VARCHAR(255)
                        - column:
                              name: user_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              defaultValue: PENDING
                              name: status
                              type: VARCHAR(20)
                        - column:
                              constraints:
                                  nullable: false
                              defaultValueNumeric: 0
                              name: total_rows
                              type: INTEGER
                        - column:
                              constraints:
                                  nullable: false
                              defaultValueNumeric: 0
                              name: success_rows
                              type: INTEGER
                        - column:
                              constraints:
                                  nullable: false
                              defaultValueNumeric: 0
                              name: fail_row
                              type: INTEGER
                        - column:
                              constraints:
                                  nullable: false
                              name: create_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                        - column:
                              constraints:
                                  nullable: false
                              name: completed_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                    tableName: upload_batches
    - changeSet:
          id: 1771695148953-10
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: upload_errors_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: upload_error_id
                              type: UUID
                        - column:
                              name: upload_batch_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: row_name
                              type: INTEGER
                        - column:
                              constraints:
                                  nullable: false
                              name: error_message
                              type: VARCHAR(255)
                        - column:
                              name: raw_data
                              type: JSONB
                        - column:
                              name: create_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                    tableName: upload_errors
    - changeSet:
          id: 1771695148953-11
          author: tola (generated)
          changes:
              - createTable:
                    columns:
                        - column:
                              constraints:
                                  nullable: false
                                  primaryKey: true
                                  primaryKeyName: audit_logs_pkey
                              defaultValueComputed: gen_random_uuid()
                              name: audit_id
                              type: UUID
                        - column:
                              constraints:
                                  nullable: false
                              name: table_name
                              type: VARCHAR(255)
                        - column:
                              name: record_id
                              type: UUID
                        - column:
                              name: action
                              type: VARCHAR(50)
                        - column:
                              name: old_data
                              type: JSONB
                        - column:
                              name: new_data
                              type: JSONB
                        - column:
                              name: change_at
                              type: TIMESTAMP WITHOUT TIME ZONE
                    tableName: audit_logs
    - changeSet:
          id: 1771695148953-12
          author: tola (generated)
          changes:
              - addUniqueConstraint:
                    columnNames: student_id, subject_id, semester_id
                    constraintName: uq_scores_student_subject_semester
                    tableName: scores
    - changeSet:
          id: 1771695148953-13
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: semester_id
                    baseTableName: scores
                    constraintName: fk_scores_semesters
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: semester_id
                    referencedTableName: semesters
                    validate: true
    - changeSet:
          id: 1771695148953-14
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: student_id
                    baseTableName: scores
                    constraintName: fk_scores_students
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: student_id
                    referencedTableName: students
                    validate: true
    - changeSet:
          id: 1771695148953-15
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: subject_id
                    baseTableName: scores
                    constraintName: fk_scores_subjects
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: subject_id
                    referencedTableName: subjects
                    validate: true
    - changeSet:
          id: 1771695148953-16
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: user_id
                    baseTableName: scores
                    constraintName: fk_scores_users
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: user_id
                    referencedTableName: users
                    validate: true
    - changeSet:
          id: 1771695148953-17
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: class_id
                    baseTableName: students
                    constraintName: fk_students_classes
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: class_id
                    referencedTableName: classes
                    validate: true
    - changeSet:
          id: 1771695148953-18
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: user_id
                    baseTableName: upload_batches
                    constraintName: fk_upload_batches_users
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: user_id
                    referencedTableName: users
                    validate: true
    - changeSet:
          id: 1771695148953-19
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: upload_batch_id
                    baseTableName: upload_errors
                    constraintName: fk_upload_errors_batches
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: upload_batch_id
                    referencedTableName: upload_batches
                    validate: true
    - changeSet:
          id: 1771695148953-20
          author: tola (generated)
          changes:
              - addForeignKeyConstraint:
                    baseColumnNames: role_id
                    baseTableName: users
                    constraintName: fk_users_roles
                    deferrable: false
                    initiallyDeferred: false
                    onDelete: NO ACTION
                    onUpdate: NO ACTION
                    referencedColumnNames: role_id
                    referencedTableName: roles
                    validate: true
    # New changeset to add active column to roles table
    - changeSet:
          id: 1771695148953-21
          author: tola
          changes:
              - addColumn:
                    tableName: roles
                    columns:
                        - column:
                              name: active
                              type: BOOLEAN
                              defaultValueBoolean: true
                              constraints:
                                  nullable: true
